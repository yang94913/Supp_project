{#基本/委托#}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>基本/委托</title>
    <link rel="stylesheet" type="text/css" href="../static/admin/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="../static/admin/css/admin.css"/>
</head>
<style>
    .content {
        position: relative;
    }

    .goback {
        position: absolute;
        right: 10px;
        top: 20px;
        padding: 9px 10px;
        width: 30px;
        height: 12px;
        line-height: 12px;
        text-align: center;
        border-radius: 2px;
        border: 1px solid #ccc;
        cursor: pointer;
        z-index: 99;
    }

    .layui-disabled, .layui-disabled:hover {
        color: #0C0C0C !important;
    }

    .layui-layer-dialog .layui-layer-content {
        font-size: 16px !important;
        color: red;
        font-weight: 600;
    }

    #testListAction {
        float: right;
    }
</style>
<body>
<div class="layui-tab page-content-wrap content">
    <div class="goback">返回</div>
{#    <ul class="layui-tab-title">#}
{#        <li class="layui-this">基本信息</li>#}
{#        <li>委托信息</li>#}
{#    </ul>#}
    <div class="layui-tab-content"> <!--- 基本信息tab-->
        <div class="layui-tab-item layui-show">
            <form class="layui-form" lay-filter="formTest" style="width: 90%;padding-top: 20px;">
                <div class="layui-form-item">
                    <label class="layui-form-label">供应商编号：</label>
                    <div class="layui-input-block">
                        <input type="text" name="supplier_code" disabled autocomplete="off"
                               class="layui-input layui-disabled">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">拼音码：</label>
                    <div class="layui-input-block">
                        <input type="text" name="input_code" disabled autocomplete="off"
                               class="layui-input layui-disabled">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">邮编：</label>
                    <div class="layui-input-block">
                        <input type="text" name="supplier_postalcode" disabled autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">地址：</label>
                    <div class="layui-input-block">
                        <input type="text" name="supplier_addres" disabled autocomplete="off"
                               class="layui-input layui-disabled">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">法人：</label>
                    <div class="layui-input-block">
                        <input type="text" name="artificial_person" disabled autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">备注：</label>
                    <div class="layui-input-block">
                        <textarea name="memo" class="layui-textarea" disabled></textarea>
                    </div>
                </div>
{#                <h3>相关资质#}
{#                    <span class="layui-btn layui-btn-small layui-btn-normal go-btn hidden-xs" id="goDetail1"><i#}
{#                            class="layui-icon"></i></span>#}
{#                </h3>#}
                <div class="layui-form" id="table-list-detail">
                    <table class="layui-hide" id="detail" lay-filter="demo"></table>
                </div>
            </form>
        </div>

{#        <div class="layui-tab-item"> <!--- 委托信息tab -->#}
{#            <form class="layui-form" lay-filter="entrustment" style="width: 90%;padding-top: 20px;">#}
{#                <div class="layui-form-item">#}
{#                    <label class="layui-form-label">委托人：</label>#}
{#                    <div class="layui-input-block">#}
{#                        <input type="text" name="client" autocomplete="off" class="layui-input">#}
{#                    </div>#}
{#                </div>#}
{##}
{#                <div class="layui-form-item">#}
{#                    <label class="layui-form-label">身份证：</label>#}
{#                    <div class="layui-input-block">#}
{#                        <input type="text" name="id_card" autocomplete="off" class="layui-input">#}
{#                    </div>#}
{#                </div>#}
{#                <div class="layui-form-item">#}
{#                    <label class="layui-form-label">联系电话：</label>#}
{#                    <div class="layui-input-block">#}
{#                        <input type="text" name="phone" autocomplete="off" class="layui-input">#}
{#                    </div>#}
{#                </div>#}
{##}
{#                <div class="layui-form-item">#}
{#                    <label class="layui-form-label">地址：</label>#}
{#                    <div class="layui-input-block">#}
{#                        <input type="text" name="address" autocomplete="off" class="layui-input">#}
{#                    </div>#}
{#                </div>#}
{##}
{#                <div class="layui-form-item">#}
{#                    <label class="layui-form-label">邮箱：</label>#}
{#                    <div class="layui-input-block">#}
{#                        <input type="text" name="mailbox" autocomplete="off" class="layui-input">#}
{#                    </div>#}
{#                </div>#}
{#                <div class="layui-form-item">#}
{#                    <div class="layui-input-block">#}
{#                        <span class="layui-btn layui-btn-normal" lay-submit lay-filter="jbxx_add"#}
{#                              id="jbxx_add">立即提交</span>#}
{#                    </div>#}
{#                </div>#}
{#            </form>#}
{#            <h3>相关资质#}
{#                <span class="layui-btn layui-btn-small layui-btn-normal go-btn hidden-xs" id="goDetail2"><i#}
{#                        class="layui-icon"></i></span>#}
{#            </h3>#}
{#            <div class="layui-form" id="table-list-detail">#}
{#                <table class="layui-hide" id="entrust" lay-filter="entrust"></table>#}
{#            </div>#}
{#        </div>#}
    </div>
</div>

<script type="text/html" id="barDemo1">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script type="text/html" id="barDemo2">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script src="../static/admin/layui/layui.js" type="text/javascript" charset="utf-8"></script>
<script>
    //Demo
    layui.use(['form', 'element', 'jquery', 'form', 'table'], function () {
        var form = layui.form;
        var element = layui.element;
        var $ = layui.jquery;
        var laydate = layui.laydate;
        var table = layui.table;
        var name = '';
        var entrust = {
            name: '',
            person: ''
        };
        var supplier_code = window.sessionStorage.getItem('supplier_code');
        $.ajax({
            type: 'get',
            url: 'jbxx_info/?supplier_code=' + supplier_code,
            success: function (res) {
                console.log('dsa', res);
                if (res.result === 0) {
                    name = res.data.supplier_code;
                    entrust.name = res.data.supplier_code;
                    entrust.person = res.data.artificial_person;
                    form.val("formTest", {
                        "supplier_code": res.data.supplier_code
                        , "input_code": res.data.input_code // 拼音码
                        , "supplier_postalcode": ''   // 邮编
                        , "faxed": ''
                        , "supplier_addres": '' // 地址
                        , "artificial_person ": '' // 法人
                        , "email": ''
                        , "memo": '' // 备注
                    });
                }
            }
        });

        $.ajax({
            type: 'get',
            url: 'jbxx_see/?supplier_code=' + supplier_code,
            success: function (res) {
                console.log('dsa', res);
                if (res.result === 0) {
                    form.val("entrustment", {
                        "client": res.data.client
                        , "id_card": res.data.id_card
                        , "phone": res.data.phone
                        , "address": res.data.address
                        , "mailbox": res.data.mailbox
                    });

                }
            }
        });
{#        table.render({#}
{#            elem: '#detail'#}
{#            , url: 'test_api/?supplier_code=' + supplier_code#}
{#            , width: 970#}
{#            , height: 312#}
{#            , parseData: function (res) { //res 即为原始返回的数据#}
{#                return {#}
{#                    "code": res.result, //解析接口状态#}
{#                    "msg": res.msg, //解析提示文#}
                    {#                  "count": res.total, //解析数据长度#}
{#                    "data": res.data //解析数据列表#}
{#                };#}
{#            }#}
{#            , cols: [[#}
{#                {field: 'id', width: 80, title: '编号', align: 'center'}#}
{#                , {field: 'cert_name', width: 140, title: '资质证书名称', align: 'center'}#}
{#                , {field: 'cert_code', width: 140, title: '资质证书编号', align: 'center'}#}
{#                , {field: 'cert_expire_date', width: 140, title: '资质有效期', align: 'center'}#}
{#                , {field: 'cert_status', width: 100, title: '证书状态', align: 'center'}#}
{#                , {title: '操作', toolbar: '#barDemo1', align: 'center', width: 120}#}
{#            ]]#}
{#        });#}
{#        console.log(window.sessionStorage.getItem('supplier_code'));#}

        table.render({
            elem: '#entrust'
            , url: 'wtxx_info/?supplier_code=' + supplier_code
            , width: 970
            , height: 312
            , parseData: function (res) { //res 即为原始返回的数据
                return {
                    "code": res.result, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    {#                  "count": res.total, //解析数据长度#}
                    "data": res.data //解析数据列表
                };
            }
            , cols: [[
                {field: 'id', width: 80, title: '序号', align: 'center'}
                , {field: 'certificates', width: 140, title: '证件名称', align: 'center'}
                , {field: 'id_card', width: 200, title: '证件编号', align: 'center'}
                , {field: 'effective_end_date', width: 140, title: '有效截止日期', align: 'center'}
                , {field: 'experience', width: 140, title: '更新日期', align: 'center'}
                , {title: '操作', toolbar: '#barDemo2', align: 'center', width: 120}
            ]]
        });

        $('#goDetail1').click(function () {
            window.sessionStorage.setItem('name', name);
            window.sessionStorage.removeItem('demoEdit');
            window.location.href = 'demo_add';
        });
        $('#goDetail2').click(function () {
            window.sessionStorage.setItem('entrust', JSON.stringify(entrust));
            window.sessionStorage.removeItem('demoEdit2');
            window.location.href = 'entrust_add';
        });
        $('.goback').click(function () {
            parent.location.href = './winning_bid_info'
        });

        //监听提交
        form.on('submit(jbxx_add)', function (data) {
            var params = Object.assign({}, data.field, {'supplier_code': supplier_code });
            console.log('params',params);
            $.ajax({
                type: 'post',
                url: 'jbxx_add/?supplier_code=' + supplier_code ,
                data: params,
                success: function (res) {
                    if (res.result === 0) {
                        layer.msg(res.msg);
                    } else {
                        layer.msg(res.msg)
                    }
                }
            })
        });
        //监听工具条
        table.on('tool(demo)', function (obj) {
            var data = obj.data;
            console.log('data', data);
            if (obj.event === 'del') {
                layer.confirm('真的删除行么', function (index) {
                    $.ajax({
                        url: "jbxx_del/?id=" + data.id,
                        type: "get",
                        success: function (data) {
                            if (data['result'] == 1) {
                                //关闭弹框
                                layer.close(index);
                                //删除这一行
                                obj.del();
                                layer.msg("删除成功", {icon: 6});
                            } else {
                                layer.msg("删除失败", {icon: 5});
                            }
                        }
                    });
                });
            } else if (obj.event === 'edit') {
                console.log('编辑行:<br>' + JSON.stringify(data));
                data.name = name;
                window.sessionStorage.setItem('demoEdit', JSON.stringify(data)); // 点击编辑的时候对当前这条数据进行缓存处理----存缓存
                window.sessionStorage.setItem('name', name);
                window.location.href = 'demo_edit';
            }
        });

        table.on('tool(entrust)', function (obj) {
            var data = obj.data;
            if (obj.event === 'del') {
                layer.confirm('真的删除行么', function (index) {
                    $.ajax({
                        url: "wtxx_del/?id=" + data.id,
                        type: "get",
                        success: function (data) {
                            if (data['result'] == 1) {
                                //关闭弹框
                                layer.close(index);
                                //删除这一行
                                obj.del();
                                layer.msg("删除成功", {icon: 6});
                            } else {
                                layer.msg("删除失败", {icon: 5});
                            }
                        }
                    });
                });
            } else if (obj.event === 'edit') {
                console.log('编辑行:<br>' + JSON.stringify(data));
                data.name = entrust.name;
                data.person = entrust.person;
                window.sessionStorage.setItem('demoEdit2', JSON.stringify(data));
                window.location.href = 'entrust_edit'
            }
        });
    });
</script>
</body>
</html>